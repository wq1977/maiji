# 目的

原本希望直接使用慧晶PaaS平台的原有接口，因慧晶暂时不能提供针对新固件的完整接口，特制定本接口。

本接口旨在完成麦极系统对慧晶锁的接入、状态管理功能。

因时间有限，本接口安全校验部分暂不涉及，在线上环境运行时，PaaS平台应通过IP白名单的方式保证接口安全运行。

#  接口

## 请求与响应

接口请求全部采用 http(s) POST 方式，url由入口地址加接口名组成，请求体和响应均为json格式(应设置Content-Type为"application/json")，其中请求参数包含固定部分和可变部分，固定部分目前定义为如下参数

|参数名|参数类型|参数描述|是否必选|参数举例|
|:---:|:---:|:---:|:---:|:---:|
|requestid|字符串|请求编号|是|"opt3a258647"|

requestid: 请求编号，重复的requestid代表同一个请求，PaaS平台可以直接返回相同requestid对应的响应，不需要重复操作。 当网络原因业务平台没有收到完整的响应时，可能会重发请求，这时会使用同样的requestid。

响应部分固定为以下格式:
```
{
    "code": 响应码,
    "msg" : 响应描述,
    "data": JSON格式的数据
}
```
1. 响应码为整数，0 代表成功，其它值为错误码
1. 响应描述为字符串，当code为0时，应设置为空字符串 "" 或者 "succ"，其它code时，应设置为可以呈现给用户的错误描述.
1. "code"为0时, data字段需设置为 {}，不应省略data字段，其他情形其具体内容根据请求的不同有所差异。

## 接口列表

### 查询锁信息

```
接口名： list
查询一把或者多把锁的信息,该请求平均每5秒调用一次.
如果给出的序列号中，有部分不存在，则仍需返回code0，同时在data字段相应位置标示不存在的序列号
```
请求（已省略固定参数部分）

|参数名|参数类型|参数描述|是否必选|参数举例|
|:---:|:---:|:---:|:---:|:---:|
|ids|array|序列号列表(如果不存在代表查询所有)|否|["sn3a258647","sn3a258648"]|
|start|integer|记录开始时间|是|1548733964364|
|end|integer|记录结束时间|是|1548833964364|

响应举例

```
{
    "code": 0,
    "msg" : "succ",
    "data": [
        {
            "id"               : "sn3a258647",
            "battery"          : 80,                // 电量百分比
            "status"           : "online",          // online, offline
            "lock-status"      : "on",              // on, off, error
            "error"            : "",                // 可以展示给用户的错误描述
            "offline-password" : "800234",          // 离线使用
            "admin-password"   : "344525",          // 管理员使用
            "guest-password"   : "655324,125432",          // 客人使用,多个密码用逗号分割
            "time"             : 154873396435,      // 锁内时间戳,PaaS平台应负责定期同步锁内时钟
            "records"          : [                  // 在请求start和end之间的所有操作记录
                {
                    "id"          : "rec001",       // 锁内唯一记录编号
                    "operation"   : "open",         // open: 开锁 close: 关锁
                    "time"        : 154873396435,   // 锁内时间戳
                    "method"      : "password"      // 操作方式，password:密码物理开锁,ble,nfc,remote：密码远程开锁, auto 代表自动落锁之类的内部逻辑操作
                    "password"    : "800234"        // 本次开锁使用的密码
                },
                {
                    "id"          : "rec002",
                    "operation"   : "close",
                    "time"        : 154873406435,
                    "method"      : "auto" 
                },
            ]
        },
        {
            "id"               : "sn3a258648",
            "error"            : "序列号不存在"
        }
    ]
}
```


### 设置锁密码

```
接口名： key/create
新增或者修改密码.PaaS平台确认收到该请求之后即可返回成功响应，业务平台会根据5秒轮训的结果确认新的密码
```
请求

|参数名|参数类型|参数描述|是否必选|参数举例|
|:---:|:---:|:---:|:---:|:---:|
|id|字符串|序列号|是|"sn3a258647"|
|password|字符串|新密码|是|"123456"|
|type|integer|密码类型（1:offline,2:admin,3:guest）|是|1|

响应举例

```
{
    "code": 0,
    "msg" : "succ",
    "data": {}
}
```

### 远程操作

```
接口名： operate
远程操作. PaaS平台确认收到该请求之后即可返回成功响应，业务平台会根据5秒轮训的结果确认操作结果
```
请求

|参数名|参数类型|参数描述|是否必选|参数举例|
|:---:|:---:|:---:|:---:|:---:|
|id|字符串|序列号|是|"sn3a258647"|
|operate|integer|操作类型(1. 开锁 2.关锁)|是|1|
|password|字符串|用于开锁的密码（如果操作为1则为必选）|否|"123456"|

响应举例

```
{
    "code": 1001,
    "msg" : "密码错误",
    "data": {}
}
```

# 错误码列表

|错误码|含义|
|:---:|:---|
|1001|密码错误|
|1002|不存在的序列号|

